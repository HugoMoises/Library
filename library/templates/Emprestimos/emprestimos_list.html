{% extends 'base.html' %}
{% block title %} Emprestimos de Livros {% endblock %}

{% block content %}
    <h1>Empréstimos registrados</h1>
    <hr>
    <div class="container-fluid">
        <form action="" method="get" class="d-flex">
          <input class="form-control me-2" type="text" name="status" id="" value="{{request.GET.status}}" placeholder="Busque pelo status do empréstimo" aria-label="Search">
          <button class="btn btn-outline-success" type="submit">Buscar</button>
          <a href="{% url 'emprestimos_list' %}" class="btn btn-outline-dark">Limpar</a>
        </form>
    </div>
    <hr>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">Livro</th>
            <th scope="col">Usuário</th>
            <th scope="col">Retirada</th>
            <th scope="col">Devolução</th>
            <th scope="col">Status</th>
            <th scope="col">Ações</th>
        </tr>
        </thead> 
        <tbody>
            {% for emprestimo in emprestimos %}
            <tr>
                <td>{{emprestimo.book.title}}</td>
                <td>{{emprestimo.person}}</td>
                <td>{{emprestimo.loan_date}}</td>    
                <td>{{emprestimo.return_date}}</td>            
                <td>{{emprestimo.status}}</td>
                  {% if not emprestimo.status == 'pending' %}
                    <td>
                        <a class="btn btn-primary" href="{% url 'emprestimo_update' emprestimo.id%}" role="button">Editar</td>
                    </td>
                  {% else %}
                    <td>
                        <form action="{% url 'aprovar_emprestimo' emprestimo.id%}" method="post">
                          {% csrf_token %}
                          <button class="btn btn-success" type="submit">Aprovar</button>
                        </form>
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#recusarEmprestimoModal{{emprestimo.id}}">Recusar</button>
                       
                    </td>
                  {% endif %}
            </tr>


              <!-- Modal para confirmar recusa da solicitação de empréstimo -->
              <div class="modal fade" id="recusarEmprestimoModal{{emprestimo.id}}" tabindex="-1">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                      <h5 class="modal-title">Recusar Empréstimo</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <p>Tem certeza que deseja recusar o empréstimo do livro <strong>{{ emprestimo.book.title }}</strong> solicitado por <strong>{{emprestimo.person}}</strong>?</p>
                    </div>
                    <div class="modal-footer">
                      <form method="POST" action="{% url 'recusar_emprestimo' emprestimo.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger">Recusar</button>
                      </form>
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
        </tbody>
    </table>
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{page_obj.previous_page_number}}">Anterior</a>
        </li>
        {% endif %}
        <li class="page-item"><span class="page-link">Página: {{page_obj.number}} de {{page_obj.paginator.num_pages}}</span></li>
    
        {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{page_obj.next_page_number}}">Próxima</a>
        </li>
        {% endif %}
      </ul>
    <a class="btn btn-secondary" href="{% url 'emprestimo_create' %}" role="button">Registrar Empréstimo</a>
{% endblock %}