{% extends 'base.html' %}
{% block title %} Emprestimos de Livros {% endblock %}

{% block content %}
    <h1>Empréstimos registrados</h1>
    <hr>
    <div class="container-fluid">
        <form action="" method="get" class="d-flex">
          <input class="form-control me-2" type="text" name="status" id="" value="{{request.GET.status}}" placeholder="Busque pelo status do empréstimo" aria-label="Search">
          <button class="btn btn-outline-success" type="submit">Buscar</button>
          <a href="{% url 'emprestimos_list' %}" class="btn btn-outline-dark">Limpar</a>
        </form>
    </div>
    <hr>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">Livro</th>
            <th scope="col">Usuário</th>
            <th scope="col">Retirada</th>
            <th scope="col">Devolução</th>
            <th scope="col">Status</th>
            <th scope="col">Ações</th>
        </tr>
        </thead> 
        <tbody>
            {% for emprestimo in emprestimos %}
            <tr>
                <td>{{emprestimo.book.title}}</td>
                <td>{{emprestimo.person}}</td>
                <td>{{emprestimo.loan_date}}</td>    
                <td>{{emprestimo.return_date}}</td>            
                <td>{{emprestimo.status}}</td>
                  {% if not emprestimo.status == 'pending' %}
                    <td>
                        <a class="btn btn-primary" href="{% url 'emprestimo_update' emprestimo.id%}" role="button">Editar</td>
                    </td>
                  {% else %}
                    <td>
                        <form action="{% url 'aprovar_emprestimo' emprestimo.id%}" method="post">
                          {% csrf_token %}
                          <button class="btn btn-success" type="submit">Aprovar</button>
                        </form>
                        <form action="{% url 'recusar_emprestimo' emprestimo.id%}" method="post">
                          {% csrf_token %}
                          <button class="btn btn-danger" type="submit">Recusar</button>
                        </form>
                    </td>
                  {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page={{page_obj.previous_page_number}}">Anterior</a>
        </li>
        {% endif %}
        <li class="page-item"><span class="page-link">Página: {{page_obj.number}} de {{page_obj.paginator.num_pages}}</span></li>
    
        {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{page_obj.next_page_number}}">Próxima</a>
        </li>
        {% endif %}
      </ul>
    <a class="btn btn-secondary" href="{% url 'emprestimo_create' %}" role="button">Registrar Empréstimo</a>
{% endblock %}